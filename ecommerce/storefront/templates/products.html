<!-- This page contains the unique components of the products catalogue page (made by Krish) -->

{% extends 'base.html' %}

{% block content %}
    <!-- Products Page -->
    <div id="products">
        <!-- Header -->
        <div class="page-header">
            <h1><i class="fas fa-gamepad"></i> Gaming Products</h1>
            <p>Explore our complete collection of premium gaming gear</p>
        </div>
        <!-- Search and Filter Functionality -->
        <div class="glass-effect">
            <form id="form" method="post" action="{% url 'products' %}" style="display: flex; justify-content: space-around;">
                {% csrf_token %}
                <div class="product-controls">
                    <label for="search"><strong>Search:</strong></label>
                    {% if query %}
                        <input class="form-component" name="search" type="text" id="search" placeholder="Search products..." value="{{ query }}" maxlength="32">
                    {% else %}
                        <input class="form-component" name="search" type="text" id="search" placeholder="Search products..." maxlength="32">
                    {% endif %}
                </div>
                <div class="product-controls">
                    <label for="sort" style="display: inline-block;"><strong>Sort:</strong></label>
                    <!-- <div id="" style="display: inline-block;"> -->
                        <select class="form-component" name="sort" id="sort">
                            {% if sort == "alphabetical" %}
                                <option class="sort-option" value="alphabetical" selected="selected">Name A to Z</option>
                            {% else %}
                                <option class="sort-option" value="alphabetical">Name A to Z</option>
                            {% endif %}

                            {% if sort == "non-alphabetical" %}
                                <option class="sort-option" value="non-alphabetical" selected="selected">Name Z to A</option>
                            {% else %}
                                <option class="sort-option" value="non-alphabetical">Name Z to A</option>
                            {% endif %}
                            
                            {% if sort == "lowest-price" %}
                                <option class="sort-option" value="lowest-price" selected="selected">Lowest Price</option>
                            {% else %}
                                <option class="sort-option" value="lowest-price">Lowest Price</option>
                            {% endif %}

                            {% if sort == "highest-price" %}
                                <option class="sort-option" value="highest-price" selected="selected">Highest Price</option>
                            {% else %}
                                <option class="sort-option" value="highest-price">Highest Price</option>
                            {% endif %}
                            
                        </select>
                    <!-- </div> -->
                </div>
                <input class="form-component" type="submit" value="Update Results">
                <button class="form-component" type="button" onclick="resetForm()">Reset Filters</button>
            </form>
        </div>
        <!-- Total Products Found -->
        <div>
            {% if count <= 1 %}
                <p style="padding: 15px;">Product Found: {{ count }}</p>
            {% else %}
                <p style="padding: 15px;">Products Found: {{ count }}</p>
            {% endif %}
        </div>
        <!-- Product Cards -->
        <div class="products-grid">
            {% for product in products %}
                {% if product.display_item %}
                    <div class="product-card">
                        <a href="{% url 'product' product.id %}" style="text-decoration: none;">
                            <!-- Add Badges for special products -->
                            <div style="position: relative;">
                                {% if product.discount %}
                                    <div class="sale-badge">Sale!!!</div>
                                {% endif %} 
                                {% if product.range.name == "Limited Edition" %}
                                    <div class="limited-edition-badge">Limited Edition</div>
                                {% endif %}
                            </div>
                            <!-- Product Image -->
                            <div class="product-img-container">
                                {% if product.image %}
                                <div>
                                    <img src="{{ product.image.url }}" alt="{{ product.name }}" width="175px">
                                </div>
                                {% else %} 
                                <div class="product-no-image">
                                    <p style="font-size: large;">{{ product.name }} <br> (Image Coming Soon)</p>
                                </div>
                                {% endif %} 
                            </div>
                        </a>
                        <!-- Product Details -->
                        <div class="product-info">
                            <a href="{% url 'product' product.id %}" style="text-decoration: none;">
                                <!-- Show custom product tagline -->
                                {% if product.tagline %}
                                    <p class="tagline" style="color: #ffffff; display: flex;">{{ product.tagline }}</p>
                                {% else %}
                                    <br>
                                    <br>
                                    <br>
                                {% endif %}
                                <!-- Shows Name and Price -->
                                <h3>{{ product.name }}</h3>
                                {% if product.discount %}
                                    <div class="product-price"><span class="dc-price">${{ product.price }}</span>
                                        &emsp;${{ product.sale_price }}
                                    </div>
                                {% else %}
                                    <h2 class="product-price" style="color: #ffffff;">${{ product.price }}</h2>
                                {% endif %}
                            </a>
                            {% if user.is_staff %}
                                <form action="{% url 'add_to_cart' product.id %}" method="post" class="add-to-cart-form">
                                    {% csrf_token %}
                                    <input type="hidden" name="qty" value="1">
                                    <button class="add-to-cart" disabled>
                                        <i class="fas fa-cart-plus"></i> Add to Cart
                                    </button>
                                </form>
                                <!-- Customize Button -->
                                {% if "mouse" in product.name|lower %}
                                <form action="{% url 'customize' product.id %}" method="get" class="customize-form">
                                <button class="add-to-cart" 
                                type="submit"  
                                style="transform: scale(0.7); width: 60%; font-size: 14px;" disabled> 
                                ðŸŽ¨ Customize</button>
                                </form>
                                {% endif %}
                            {% else %}
                                <form action="{% url 'add_to_cart' product.id %}" method="post" class="add-to-cart-form">
                                    {% csrf_token %}
                                    <input type="hidden" name="qty" value="1">
                                    <button class="add-to-cart">
                                        <i class="fas fa-cart-plus"></i> Add to Cart
                                    </button>
                                </form>
                                <!-- Customize Button -->
                                {% if "mouse" in product.name|lower %}
                                <form action="{% url 'customize' product.id %}" method="get" class="customize-form">
                                <button class="add-to-cart" 
                                type="submit"  
                                style="transform: scale(0.7); width: 60%; font-size: 14px;"> 
                                ðŸŽ¨ Customize</button>
                                </form>
                                {% endif %}
                            {% endif%}
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    <!-- Code for resetting product search and filter functionality -->
    <script>
        function resetForm() {
            console.log("Resetting form...");
            document.getElementById("form").reset();
            window.location.href = "{% url 'products' %}";
        }
    </script>
{% endblock %}